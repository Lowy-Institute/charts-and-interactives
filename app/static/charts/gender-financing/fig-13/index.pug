extend /partials/layout

block append config
  - var datapath = "static/charts/gender-financing/fig-13/data"
  - var colorpath = "static/charts/templates/colors/data"
  - _.extend(page, data.getOne(datapath))
  - _.extend(page, data.getOne(colorpath))
  - toPercent = (n) => (n * 100).toFixed(2) + "%"
  - chart = page
  - red = "#ff4050"
  - redtxt = "#990f02"
  //- green = "#16B56F"
  - green = "#094b2e"
  - greentxt = "#005600"
  
block page
  .wrapper
    h1.txt-center= chart.title
    h2.txt-center.txt-muted= chart.subtitle
    table.mx-auto(cellspacing=0)
      thead
        tr
          th(color="#444" style="border-right:1px solid #444; border-bottom: 1px solid #444;") Country
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2008
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2009
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2010
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2011
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2012
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2013
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2014
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2015
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2016
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2017
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2018
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2019
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2020

      tbody

        // adjust hues slightly
        each country, i in chart.series[0].values
          tr
            td= country
            each v, j in chart.series[1].values[i]
              - v = +v
              - if (v === 0)
                - hue = 0
                - saturation = 50
                - lightness = 49
              - else if (v < 290)
                - hue = Math.floor((v / 290) * 60)
                - saturation = 70 + Math.floor((v / 290) * 20)
                - lightness = 60 + Math.floor((v / 290) * 10)
              - else if (v <= 290)
                - hue = Math.floor(50 + ((v - 290) / (2500 - 290)) * 50)
                - saturation = 60 - Math.floor(((v - 290) / (2500 - 290)) * 20)
                - lightness = 60 + Math.floor(((v - 290) / (2500 - 290)) * 10)
              - else
                - hue = Math.floor(100 + ((v - 2500) / (4500 - 2500)) * 50)
                - saturation = 60 - Math.floor(((v - 2500) / (4500 - 2500)) * 20)
                - lightness = 60 - Math.floor(((v - 2500) / (4500 - 2500)) * 10)
              - color = v > 0 ? "green" : v < 0 ? "red" : "black"
              - textColor = lightness < 50 ? 'white' : 'black' // Determine text color based on background lightness
              td(
                style=`background-color: hsl(${hue}, ${saturation}%, ${lightness}%); color: ${color};`
              )
                span(style=`color: ${textColor};`) #{"$" + v.toFixed(1)}

    .chart-source.txt-right.txt-muted.txt-cond!= chart.source

block append css
  style
    :sass
      html,
      body
        height: auto
        overflow: auto 

      h1
        margin: auto
        font-size: 20px
        
      h2
        font-weight: 600
        height: 10px
        /* margin-top: -10px */
        font-size: 15px
      
      h1,h2
        font-family: "Sans"
        
      table
        border-bottom: 1px solid
        
      th
        border-top: 0px solid
        border-bottom: 0px solid
        padding: 6px .5rem 4px
        /* color: #fff

      td,th
        text-align: right
        font-size: 12px
        
      td
        padding: 3px .5rem
        
        span
          opacity: 1
        
      .wrapper
        padding: 2rem 0

      .chart-notes, .chart-source
        margin-top: 1em
        margin-right: 1.5em
        font-size: 15px
