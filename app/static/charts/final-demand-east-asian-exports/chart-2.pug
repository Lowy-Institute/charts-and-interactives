extend /partials/layout

block append config
  - page.title = "Figure 2: A big shift towards East Asian demand"
  - var chart = { height: 320, width: 560, inset: { x: 20, y: 28 } }

block page
  .wrapper
    svg(
      width=`${chart.width}px`
      height=`${chart.height}px`
      viewBox=`0 0 ${chart.width} ${chart.height}`
      data-view="match"
    )
      rect(width="100%" height="100%" fill="none")
      g
        text.tt2.tt3(text-anchor="end" x=chart.inset.x * 2 y=10) %
        for n, i in (new Array(6))
          - var y = (chart.inset.y + i * (chart.height - chart.inset.y - 56) / 5)
          text.tt2.tt3(text-anchor="end" x=chart.inset.x * 2 y=y + 4)
            | #{100 - i * 20}
          line.st1(
            x1=48
            x2=(chart.width - chart.inset.x)
            y1=y
            y2=y
          )

      g.bars(transform="translate(0 8)")
        g(data-link="2" data-id="2")
          rect.st2(x="156" y="205.55" width="96" height="50.45")
          text.tt1.tt3(text-anchor="middle" y=(5 + 205.55 + (50.95 / 2)) x=204) 21.1%
        g(data-link="3" data-id="3")
          rect.st3(x="156" y="159.95" width="96" height="45.59")
          text.tt1.tt3(text-anchor="middle" y=(5 + 159.95 + (45.59 / 2)) x=204) 19.3%
        g(data-link="4" data-id="4")
          rect.st4(x="156" y="149.23" width="96" height="10.73")
          text.tt1.tt3(text-anchor="middle" y=(5 + 149.23 + (10.73 / 2)) x=204) 5.1%
        g(data-link="5" data-id="5")
          rect.st5(x="156" y="71.45" width="96" height="77.77")
          text.tt1.tt3(text-anchor="middle" y=(5 + 71.45 + (77.77 / 2))  x=204) 32.0%
        g(data-link="6" data-id="6")
          rect.st6(x="156" y="20" width="96" height="51.45")
          text.tt1.tt3(text-anchor="middle" y=(5 + 20.5 + (50.95 / 2))  x=204) 22.5%

        text.tt2.tt3(text-anchor="middle" y=280 x=204) 2007

      g.bars(transform="translate(0 8)")
        g(data-link="2" data-id="2")
          rect.st2(x="348" y="216.27" width="96" height="39.73")
          text.tt1.tt3(text-anchor="middle" y=(5 + 216.27 + (40.23 / 2)) x=396) 17.2%
        g(data-link="3" data-id="3")
          rect.st3(x="348" y="181.41" width="96" height="34.86")
          text.tt1.tt3(text-anchor="middle" y=(5 + 181.41 + (34.86 / 2)) x=396) 14.1%
        g(data-link="4" data-id="4")
          rect.st4(x="348" y="170.68" width="96" height="10.73")
          text.tt1.tt3(text-anchor="middle" y=(5 + 170.68 + (10.73 / 2)) x=396) 4.3%
        g(data-link="5" data-id="5")
          rect.st5(x="348" y="76.82" width="96" height="93.86")
          text.tt1.tt3(text-anchor="middle" y=(5 + 76.82 + (93.86 / 2)) x=396) 40.3%
        g(data-link="6" data-id="6")
          rect.st6(x="348" y="20" width="96" height="56.82")
          text.tt1.tt3(text-anchor="middle" y=(5 + 20.5 + (56.32 / 2)) x=396) 24.1%
          
        text.tt2.tt3(text-anchor="middle" y=280 x=396) 2017

      g
        g(data-link="2" data-id="2" transform="translate(80 0)")
          rect.st2(x=0 y=305 width=12 height=12)
          text.tt2.tt3(x=16 y=316) US
        g(data-link="3" data-id="3" transform="translate(128 0)")
          rect.st3(x=0 y=305 width=12 height=12)
          text.tt2.tt3(x=16 y=316) EU
        g(data-link="4" data-id="4" transform="translate(176 0)")
          rect.st4(x=0 y=305 width=12 height=12)
          text.tt2.tt3(x=16 y=316) Other Western economies
        g(data-link="5" data-id="5" transform="translate(360 0)")
          rect.st5(x=0 y=305 width=12 height=12)
          text.tt2.tt3(x=16 y=316) East Asia
        g(data-link="6" data-id="6" transform="translate(444 0)")
          rect.st6(x=0 y=305 width=12 height=12)
          text.tt2.tt3(x=16 y=316) Rest of world

    style
      :sass
        .st1 
          fill: none
          stroke: #e4e8ea
        .st2 
          fill: #002b45
        .st3 
          fill: #2e75b6
        .st4 
          fill: #539ed4
        .st5 
          fill: #f7931e
        .st6
          fill: #b2c6d4
        .st7
          stroke: none !important
        .tt1
          fill: #fff
          opacity: 0
          transition: opacity 300ms
        .tt2
          fill: #666
        .tt3
          font-size: 14px

        .bars
          .st2,.st3,.st4,.st5
            stroke: #fff
            stroke-opacity: 0
            transition: inherit

        .inactive
          opacity: 0.5
          rect
            fill: #bbb
            .bars &
              stroke-opacity: 1
        .active
          opacity: 1
          rect
            .bars &
              stroke-opacity: 1
          .tt1
            opacity: 1

        [data-id]
          transition: all 300ms
