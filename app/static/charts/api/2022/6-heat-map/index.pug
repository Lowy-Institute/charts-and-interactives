extend /partials/layout

block append config
  - var datapath = "static/charts/api/2022/6-heat-map/data"
  - var colorpath = "static/charts/templates/colors/data"
  - _.extend(page, data.getOne(datapath))
  - _.extend(page, data.getOne(colorpath))
  - toPercent = (n) => (n * 100).toFixed(2) + "%"
  - chart = page
  - red = "#ff4050"
  - redtxt = "#990f02"
  - green = "#16B56F"
  - greentxt = "#006500"
  
block page
  .wrapper
    h1.txt-center= chart.title
    h2.txt-center.txt-muted= chart.subtitle
    table.mx-auto(cellspacing=0)
      //thead
        tr
          th(rowspan="2" bgcolor="#444" style="border-right:1px solid #fff;") Country
          th(colspan="" bgcolor="#444" style="text-align:center;border-bottom: 1px solid #fff;") Score change
        tr(bgcolor="#444")
          th 2019
          th 2020
          th 2021
          th 2023
          th Overall Loss (2020-2023)
      thead
        tr
          th(rowspan="2" color="#444" style="border-right:1px solid #444; border-bottom: 1px solid #444;") Country
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2020
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2021
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") 2023
          th(color="#444" style="text-align:center;border-bottom: 1px solid #444;") (2020-2023)
        tr(color="#444; ")
          th(colspan="3" style="text-align:center; border-bottom: 1px solid #444; border-right:1px solid #444; ") Annual changes 
          th(style="border-bottom: 1px solid #444;") Three-year net change
      tbody
        for country,i in chart.series[0].values
          tr
            td= country
            for v,j in chart.series[1].values[i]
              - v = +v
              - color = Math.abs(v) < 0.1 ? "" : v > 0 ? greentxt : redtxt
              - bgcolor = v > 0 ? green : red
              - ratio = (255 * (v > 0 ? v / 1.5 : v / -5.5)).toFixed(0)
              - intensity = ("0" + (+ratio).toString(16)).slice(-2)
              //- v = null ? "null" : (v)
              td(
                style=`background-color: ${bgcolor}${intensity}; color: ${color};`
              )
                span= (v).toFixed(1)

    .chart-source.txt-right.txt-muted.txt-cond!= chart.source

block append css
  style
    :sass
      html,
      body
        height: auto
        overflow: auto
        
      h1
        font-size: 20px
        font-weight: 600
        /* text-transform: uppercase
        margin-bottom: 0.2rem
        
      h2
        margin-bottom: 1em
        /* font-weight: 600
        font-size: 15px
      
      h1,h2
        font-family: "Sans"
        
      table
        border-bottom: 1px solid
        
      th
        border-top: 0px solid
        border-bottom: 0px solid
        padding: 6px 1rem 4px
        /* color: #fff

      td,th
        text-align: right
        font-size: 16px
        
      td
        padding: 3px 1rem 3px 2.5rem
        
        span
          opacity: 1
        
      .wrapper
        padding: 2rem 0

      .chart-notes, .chart-source
        margin-top: 1em
        margin-right: 1.5em
        font-size: 15px
