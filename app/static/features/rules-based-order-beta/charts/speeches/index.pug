extend /partials/layout

block append config
  - var datapath = "static/features/rules-based-order/charts/speeches/data"
  - _.extend(page, data.getOne(datapath))
  - toPercent = (n) => (n * 100).toFixed(2) + "%"

block page
  .wrapper.flex.flex-col
    - chart = page.charts[0]
    .page-title.txt-center.txt-cond!= page.title
    .col-wrap.txt-center.flex-grow.flex.txt-sm
      .chart.flex-grow: .chart-content
        - scale = chart.scale
        - fx = (i) => (i + 0.75) / (chart.axes[1].values.length + 1.2 )
        - fy = (y) => (y - scale.minY) / (scale.maxY - scale.minY)
        svg(height="100%" width="100%")
          svg(height="100%")
            for n, i in new Array(10)
              - y = 1 - (i / 9)
              svg(y=toPercent(y))
                text(text-anchor="end" transform="translate(-8 4)")
                  = scale.minY + (i/9) * (scale.maxY - scale.minY)
                  
              svg(width="100%" height="100%")
                  line(
                    x1="0" y1=toPercent(y) x2="100%" y2=toPercent(y)
                    stroke="#ddd"
                    stroke-width=.5
                  )     

          g
            for y, i in chart.axes[1].values
              - label = chart.axes[0].values[i]
              svg(
                x=toPercent(fx(i))
                y=toPercent(1 - fy(y))
                width=toPercent(fx(0))
                height=toPercent(fy(y))
              )
                rect(
                  width="100%"
                  height="100%"
                  fill=chart.colors[0]
                )

                text.chart-value(
                  x="50%"
                  y=-8
                  text-anchor="middle"
                )
                  = y

                svg(x="50%" y="100%")
                  text(
                    text-anchor="end"
                    transform="rotate(-45) translate(-4 13)"
                  )
                    =label

  //- .chart-source.txt-muted
    != page.source

block append css
  style
    :sass
      .wrapper
        height: 450px

      .col-md
        padding: 0 1em
        width: 50%

      .chart
        position: relative

      .chart-content
        position: absolute
        top: 20px
        left: 75px
        right: 25px
        bottom: 45px

      .chart-content > svg
        border-bottom: 1px solid #ccc
        height: 20px
        min-height: 100%

      .page-title
        font-size: 20px
        font-weight: 500

      .chart-source
        font-size: 14px
        max-width: 800px
        margin: 12px 8px 0

      .chart-value
        opacity: 0
        transition: opacity 300ms

        .chart:hover &
          opacity: 1

      text
        font-size: 14px
        fill: currentColor

      svg
        overflow: visible
        
      rect
        transition-duration: .2s
        fill: #002b45
      rect:hover
        fill: #539ed4
                

      @media screen and (max-width: 600px)
        .page-title
          font-size: 17px
